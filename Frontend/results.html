<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Axe and Fire | Results</title>
  <link href="https://fonts.googleapis.com/css2?family=Megrim&family=Inter:wght@300;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>

<body class="voting-page">

  <div class="content-wrapper">
    <h1 class="main-title">Playlist</h1>
    <p class="subtitle">Based on the last 5 votes of each guest</p>

    <div id="output" class="playlist-results">
    </div>

    <div class="button-group">
      <a href="voting.html" class="action-btn">Back to Voting</a>
      <button class="action-btn" onclick="window.location.href='index.html'">Change User</button>
    </div>
  </div>

  <script>
    async function displayResults() {
      const output = document.getElementById('output');
      const API_URL = 'http://localhost:8080/api';

      try {

        const response = await fetch(`${API_URL}/playlist`);
        if (!response.ok) throw new Error('Server error');

        const playlistData = await response.json();

        const songs = Array.isArray(playlistData) ? playlistData : (playlistData.songs || []);

        output.innerHTML = '';

        if (songs.length === 0) {
          output.innerHTML = '<p class="subtitle">No valid votes yet. Go back and vote!</p>';
          return;
        }


        songs.forEach((item, index) => {
          const isWinner = index === 0 ? 'winner' : '';

          const voteCount = item.votes !== undefined ? item.votes : (item.anzahlStimmen || item.voteCount || 0);

          output.innerHTML += `
                    <div class="result-card ${isWinner}">
                        <div class="vote-badge">${voteCount}</div>
                        <div class="track-meta">
                            <h3>${item.band}</h3>
                            <p>${item.titel || item.song} | ${item.genre}</p> 
                        </div>
                    </div>`;
        });

      } catch (error) {
        console.error('Error:', error);
        output.innerHTML = '<p class="subtitle" style="color: red;">Failed to load results. Check if backend is running.</p>';
      }
    }


    window.resetData = function () {
      if (confirm('Reset local session? To clear all server data, restart the Spring Boot application.')) {
        sessionStorage.clear();
        localStorage.clear();
        location.reload();
      }
    };


    displayResults();
  </script>
</body>

</html>
